function err_ = quickT4_err(fits, guess, lapse)% function err_ = quickT4_err(fits, guess, lapse)%% Computes the error of the Time-dependent Quick function %   fit, given the data (as a global) and the Quick %   parameters (fit "fits").% Used by fmincon.% See quickT4_val for the definition of the Quick(-like)%   function used.%% Input:%   fits is the vector of 4-6 Quick parameters ...%       fits(1) = A = threshold coefficient%       fits(2) = m = threshold exponent%       fits(3) = B = slope coefficient%       fits(4) = n = slope exponent%       fits(5) = guess (optional)%       fits(6) = lapse (optional)%   guess is opional fixed value of guess (overrides fits(5))%   lapse is opional fixed value of lapse (overrides fits(6))%%   Data is the (global) (duhh) data, in columns ...%		Data(:, 1) = abscissa (e.g., coh)%		Data(:, 2) = observed percent correct (0..1)%		Data(:, 3) = number of observations.%% Returns:%	err_ ... the negative of the log likelihood of obtaining the data %					using the given parameters.%global Dataif nargin == 1        % all 6 fits should be given in "fits"    ps = quickT4_val(Data(:,1:end-1), fits);else        if isempty(guess)                 % fix lapse rate        ps = quickT4_val(Data(:,1:end-1), [fits lapse]);    elseif isempty(lapse)        % fix guess rate        ps = quickT4_val(Data(:,1:end-1), [fits(1:4) guess fits(5)]);            else                % fix both guess and lapse rates        ps = quickT4_val(Data(:,1:end-1), [fits guess lapse]);    endend% Now calculate the joint probability of obtaining the data set conceived as%   a list of Bernoulli trials.  This is just ps for trials = 1 (correct) and %   1-ps for trials of 0 (error).% Avoid log 0ps(ps==0) = 0.0001;ps(ps==1) = 1 - 0.0001;err_      = -sum(log([ps(Data(:,end)==1); 1-ps(Data(:,end)==0)]));