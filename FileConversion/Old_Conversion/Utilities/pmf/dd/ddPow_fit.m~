function [fits_,sems_,llik_,pred_]=ddPow_fit(data)%% ddPow_fit fits a drift-diffusion-with-drift model to psychometric%   data (versus coh and time in a deadline-type task) using%   maximum likelihood maximization under binomial assumptions. It uses%   ddPow_err for error calculation.%%  Usage: [fits_,sems_,llik_,pred_]=ddPow_fit(data)% 	Input values are:%     data, in 3 columns...%		         data(1) = coh (% coherence, 0 ... 100)%                data(2) = time (seconds)%                data(3) = dot dir (-1 = left; 1 = right)%                data(4) = correct (0 = error; 1 = correct)%% 	Return values are:%		fits  ... see ddPow_val%       params(1) ... B      (bias)%       params(2) ... A      (coh scale)%       params(3) ... M      (coh exponent)%       params(4) ... N      (time exponent)%       params(5) ... lambda ("lapse")%       sems,  Standard errors of the fits. Approximated using the%              numerical HESSIAN returned by fmincon%		llik,  The log likelihood of obtaining the data give the fit%       pred,  A vector of the probability of making a correct choice given%              the fitglobal Data;if nargin < 1 || isempty(data)    return;endData = data;%% do the fit[fits,f,e,o,l,g,H] = fmincon('ddPow_err', ...    [   0  40      1  1  0   ]', [], [], [], [], ...    [ -1   0.001 -5 -5  0.0 ]', ...    [  1 500      5  5  0.4 ]', [], ...    optimset('LargeScale', 'off', 'Display', 'off', 'Diagnostics', 'off'));% return the fitsif nargout > 0    fits_ = fits';end% return log likelihoodif nargout > 1    llik_ = -ddPow_err(fits);end% return the predicted probability (of a correct response) for each observationif nargout > 2    pred_ = ddPow_val(Data(:,1:end-1), fits);end% standard errors% The covariance matrix is the negative of the inverse of the % hessian of the natural logarithm of the probability of observing % the data set given the optimal parameters.% For now, use the numerically-estimated HESSIAN returned by fmincon% (which remember is computed from -log likelihood)if nargout > 3        % -H because we used -logL in quick_err    sems_ = sqrt(diag(-((-H)^(-1))));end